<!DOCTYPE html>
<html lang="zxx">
<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Awaiken">
    <!-- Page Title -->
    <title>Inclub - Single Property HTML Template</title>
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png">
    <!-- Google Fonts Css-->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">
    <!-- Bootstrap Css -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- SlickNav Css -->
    <link href="/css/slicknav.min.css" rel="stylesheet">
    <!-- Swiper Css -->
    <link rel="stylesheet" href="/css/swiper-bundle.min.css">
    <!-- Font Awesome Icon Css-->
    <link href="/css/all.min.css" rel="stylesheet" media="screen">
    <!-- Animated Css -->
    <link href="/css/animate.css" rel="stylesheet">
    <!-- Magnific Popup Core Css File -->
    <link rel="stylesheet" href="/css/magnific-popup.css">
    <!-- Mouse Cursor Css File -->
    <link rel="stylesheet" href="/css/mousecursor.css">
    <!-- Main Custom Css -->
    <link href="/css/custom.css" rel="stylesheet" media="screen">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    .card {
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 1);
        margin-bottom: 20px;
    }
    .status {
        padding: 5px 10px;

        border-radius: 5px;
        font-weight: bold;
    }
    .status-pending {
        background-color: #f16434;
        color: #fff;
    }

</style>


</head>
<body  onload="ReadgaurdData()">

<!-- Preloader Start -->
<div class="preloader">
    <div class="loading-container">
        <div class="loading"></div>
        <div id="loading-icon"><img src="/images/loader.svg" alt=""></div>
    </div>
</div>
<!-- Preloader End -->

<!-- Header Start -->
<%-include('../partials/adminheader')%>
<!-- Header End -->


<!-- Page Header Start -->
<div class="page-header parallaxie" style="background-image: url('/images/comp.jpg')" >
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- Page Header Box Start -->
                <div class="page-header-box">
                    <h1 class="text-anime-style-2" data-cursor="-opaque">User Complaints</h1>

                </div>
                <!-- Page Header Box End -->
            </div>
        </div>
    </div>
</div>
<!-- Page Header End -->

<div  class=" container ">
    <div   id="records" class="row">

    </div>

</div>


<!-- Main Footer Section Start -->
<footer class="main-footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- Footer Content Start -->
                <div class="footer-content">
                    <!-- Footer Logo Start -->
                    <div class="footer-logo">
                        <img src="images/footer-logo.svg" alt="">
                    </div>
                    <!-- Footer Logo End -->

                    <!-- Footer Contact Info Start -->
                    <div class="footer-contact-info">
                        <h2><a href="#">info@domainname.com</a></h2>
                        <h3><a href="tel:456789235">+01 456 789 235</a></h3>
                        <p>3891 ranchview dr. richardson, california 62639</p>
                    </div>
                    <!-- Footer Contact Info End -->

                    <!-- Footer Social Icon Start -->
                    <div class="footer-social-icon">
                        <ul>
                            <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                            <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#"><i class="fa-brands fa-dribbble"></i></a></li>
                        </ul>
                    </div>
                    <!-- Footer Social Icon End -->

                    <!-- Footer Link List Start -->
                    <div class="footer-link-list">
                        <!-- Footer Links Start -->
                        <div class="footer-links">
                            <ul>
                                <li><a href="projects.html">About project</a></li>
                                <li><a href="#">Construction progress</a></li>
                                <li><a href="#">Documentation</a></li>
                            </ul>
                        </div>
                        <!-- Footer Links End -->

                        <!-- Footer Links Start -->
                        <div class="footer-links">
                            <ul>
                                <li><a href="#">Privacy policy</a></li>
                                <li><a href="#">The terms</a></li>
                            </ul>
                        </div>
                        <!-- Footer Links End -->
                    </div>
                    <!-- Footer Link List End -->
                </div>
                <!-- Footer Content End -->

                <!-- Footer Copyright Text Start -->
                <div class="footer-copyright-text">
                    <p>Copyright Â© 2025 All Rights Reserved.</p>
                </div>
                <!-- Footer Copyright Text End -->
            </div>
        </div>
    </div>
</footer>
<!-- Main Footer Section End -->





<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Jquery Library File -->
<script src="/js/jquery-3.7.1.min.js"></script>
<!-- Bootstrap js file -->
<script src="/js/bootstrap.min.js"></script>
<!-- Validator js file -->
<script src="/js/validator.min.js"></script>
<!-- SlickNav js file -->
<script src="/js/jquery.slicknav.js"></script>
<!-- Swiper js file -->
<script src="/js/swiper-bundle.min.js"></script>
<!-- Counter js file -->
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.counterup.min.js"></script>
<!-- Magnific js file -->
<script src="/js/jquery.magnific-popup.min.js"></script>
<!-- SmoothScroll -->
<script src="/js/SmoothScroll.js"></script>
<!-- Parallax js -->
<script src="/js/parallaxie.js"></script>
<!-- MagicCursor js file -->
<script src="/js/gsap.min.js"></script>
<script src="/js/magiccursor.js"></script>
<!-- Text Effect js file -->
<script src="/js/SplitText.js"></script>
<script src="/js/ScrollTrigger.min.js"></script>
<!-- YTPlayer js File -->
<script src="/js/jquery.mb.YTPlayer.min.js"></script>
<!-- Wow js file -->
<script src="/js/wow.min.js"></script>
<!-- Main Custom js file -->
<script src="/js/function.js"></script>

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-validation/dist/jquery.validate.js"></script>
<script src="https://cdn.jsdelivr.net/gh/cosmogicofficial/quantumalert@latest/minfile/quantumalert.js" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="/email.js"></script>




<script>

    async function ReadgaurdData() {
        try {

            var res = await fetch('/admin/viewcomplaints');
            res = await res.json();
            var records = res.records;
            console.log(records);
            var html = ``;
            for (var x of records)
            {

                let timestamp=x.date;
                let dateObj = new Date(timestamp);
                let issue = dateObj.toISOString().split("T")[0];
           if( x.status=="Addressed")
           {
               html += `

            <div class="card p-3 mt-3 col col-md-6" >
                <h5>${x.user.name}</h5>
                <p><strong>Email:</strong>${x.email}</p>
 <p><strong>Date:</strong> ${issue}</p>
                <p><strong>Complaint:</strong> ${x.description}</p>
 <p><strong>Suggestion:</strong> ${x.suggestion}</p>
               <span class="status status-pending"> <strong>Status:</strong> ${x.status}</span>

            </div>
        </div>


                </div>
</div>`

           }
           else{
               html += `

            <div class="card p-3 mt-3 col col-md-6" >
                <h5>${x.user.name}</h5>
                <p><strong>Email:</strong>${x.email}</p>
 <p><strong>Date:</strong> ${issue}</p>
                <p><strong>Complaint:</strong> ${x.description}</p>
 <p><strong>Suggestion:</strong> ${x.suggestion}</p>
               <span class="status status-pending"> <strong>Status:</strong> ${x.status}</span>`
               html+=` <div class="container w-50 text-center"><button type="button" class ="btn btn-success btn-sm border-white mt-2 w-50" onclick="addressed(${x.id})">Address Issue</button></div>

            </div>
        </div>


                </div>
</div>`


           }

            }

            document.getElementById('records').innerHTML = html;
        } catch (e) {
            console.log(e.message);
        }
    }



    async function addressed(id)
    {
        var res = await fetch('/admin/changecomplaint/'+ id,
            {method:'PUT',
            headers:{'Content-Type':'application/json'},
            body: JSON. stringify({
                status:'Addressed'
            })
            }
        );
        res = await res.json();
        if(res.error)
        {
            Qual.errordb("Error",res.message);
        }
        else
        {
            Qual.successdb("Success",res.message);
        }

    }


</script>



</body>
</html>